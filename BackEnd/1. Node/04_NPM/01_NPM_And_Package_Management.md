# Node.js — NPM & Package Management

**NPM (Node Package Manager)** is the default package manager for Node.js. It is used to install, manage, and share reusable JavaScript packages. It comes bundled with every Node.js installation.

---

## 1. What Is NPM?

NPM consists of three things:

| Component | Description |
|-----------|-------------|
| **CLI tool** | Command-line tool for installing and managing packages (`npm install`, `npm run`, etc.) |
| **Registry** | Online database of open-source packages (npmjs.com) — over 2 million packages |
| **Website** | [npmjs.com](https://www.npmjs.com/) — browse, search, and publish packages |

### Verify Installation

```bash
node --version    # v20.10.0
npm --version     # 10.2.3
```

---

## 2. Initializing a Project

### `npm init` — Create `package.json`

```bash
# Interactive — prompts for project details
npm init

# Skip prompts — accept all defaults
npm init -y
```

This creates a `package.json` file, which is the **manifest** of your project:

```json
{
  "name": "my-app",
  "version": "1.0.0",
  "description": "A sample Node.js application",
  "main": "index.js",
  "type": "module",
  "scripts": {
    "start": "node index.js",
    "dev": "nodemon index.js",
    "test": "jest"
  },
  "dependencies": {
    "express": "^4.18.2"
  },
  "devDependencies": {
    "nodemon": "^3.0.2",
    "jest": "^29.7.0"
  }
}
```

### Key Fields in `package.json`

| Field | Description | Example |
|-------|-------------|---------|
| `name` | Project name (lowercase, no spaces) | `"my-app"` |
| `version` | Project version (SemVer) | `"1.0.0"` |
| `description` | Brief project description | `"REST API for users"` |
| `main` | Entry point file | `"index.js"` |
| `type` | Module system: `"module"` (ESM) or `"commonjs"` (CJS) | `"module"` |
| `scripts` | Custom CLI commands | `{ "start": "node app.js" }` |
| `dependencies` | Production packages | `{ "express": "^4.18.2" }` |
| `devDependencies` | Development-only packages | `{ "nodemon": "^3.0.2" }` |
| `engines` | Required Node/npm versions | `{ "node": ">=18" }` |
| `license` | License type | `"MIT"` |

---

## 3. Installing Packages

### Local Installation (Project-Specific)

```bash
# Install as a production dependency
npm install express
npm i express              # Shorthand

# Install as a development dependency
npm install --save-dev nodemon
npm i -D nodemon           # Shorthand

# Install a specific version
npm install express@4.18.2

# Install multiple packages at once
npm install express cors dotenv
```

| Flag | Saves To | Use Case |
|------|----------|----------|
| (none) | `dependencies` | Packages needed at runtime |
| `--save-dev` / `-D` | `devDependencies` | Packages needed only during development |

### Dependencies vs DevDependencies

| Category | Purpose | Examples |
|----------|---------|---------|
| `dependencies` | Required to **run** the application | `express`, `mongoose`, `jsonwebtoken` |
| `devDependencies` | Required only during **development** | `nodemon`, `jest`, `eslint`, `prettier` |

When deploying, `npm install --production` installs only `dependencies` (not `devDependencies`).

### Global Installation

Global packages are installed system-wide and available as CLI commands from any directory:

```bash
npm install -g nodemon
npm install -g npm          # Update npm itself

# List globally installed packages
npm list -g --depth=0
```

Common global packages: `nodemon`, `pm2`, `typescript`, `create-react-app`

### `node_modules` Folder

When you run `npm install`, packages are downloaded into the `node_modules` directory. This folder:
- Contains all installed packages and their dependencies
- Can be very large (hundreds of MB)
- Should **always** be in `.gitignore` — it can be rebuilt with `npm install`

---

## 4. `package-lock.json`

The lock file is **auto-generated** and records the **exact versions** of every installed package (including nested dependencies).

| `package.json` | `package-lock.json` |
|-----------------|---------------------|
| Specifies version **ranges** (`^4.18.2`) | Records **exact** versions (`4.18.2`) |
| Edited manually | Auto-generated by npm |
| Defines what you want | Defines what you have |

**Purpose:** Ensures that every developer and every deployment gets the exact same dependency tree. Always commit `package-lock.json` to version control.

---

## 5. NPM Scripts

Define custom commands in the `scripts` field of `package.json`:

```json
{
  "scripts": {
    "start": "node server.js",
    "dev": "nodemon server.js",
    "build": "tsc",
    "test": "jest",
    "lint": "eslint .",
    "format": "prettier --write ."
  }
}
```

### Running Scripts

```bash
# Special scripts (no 'run' needed)
npm start       # Runs "start" script
npm test        # Runs "test" script

# Custom scripts (require 'run')
npm run dev
npm run build
npm run lint
```

### Pre and Post Scripts

NPM automatically runs `pre` and `post` scripts before/after the main script:

```json
{
  "scripts": {
    "prebuild": "echo 'Cleaning...'",
    "build": "tsc",
    "postbuild": "echo 'Build complete!'"
  }
}
```

Running `npm run build` executes: `prebuild` → `build` → `postbuild`

---

## 6. Semantic Versioning (SemVer)

NPM uses **Semantic Versioning** to manage package versions. A version number has three parts:

```
MAJOR.MINOR.PATCH
  1  .  4  .  2
```

| Part | When to Increment | Example |
|------|-------------------|---------|
| **MAJOR** | Breaking changes (incompatible API changes) | `1.0.0` → `2.0.0` |
| **MINOR** | New features (backwards-compatible) | `1.0.0` → `1.1.0` |
| **PATCH** | Bug fixes (backwards-compatible) | `1.0.0` → `1.0.1` |

### Version Range Symbols

| Symbol | Meaning | Example | Allows |
|--------|---------|---------|--------|
| `^` (caret) | Compatible with major version | `^1.4.2` | `>=1.4.2` and `<2.0.0` |
| `~` (tilde) | Compatible with minor version | `~1.4.2` | `>=1.4.2` and `<1.5.0` |
| (none) | Exact version | `1.4.2` | Only `1.4.2` |
| `*` | Any version | `*` | Latest |
| `>=` | Greater than or equal | `>=1.4.2` | `1.4.2` and above |

The **caret `^`** is the default when you `npm install` a package. It's the safest — allows patches and minor updates but not breaking changes.

---

## 7. Common NPM Commands

### Package Management

| Command | Description |
|---------|-------------|
| `npm install` | Install all packages from `package.json` |
| `npm install <pkg>` | Install a package (adds to `dependencies`) |
| `npm install -D <pkg>` | Install as dev dependency |
| `npm install -g <pkg>` | Install globally |
| `npm install <pkg>@<ver>` | Install specific version |
| `npm uninstall <pkg>` | Remove a package |
| `npm update` | Update all packages to latest allowed versions |
| `npm update <pkg>` | Update a specific package |
| `npm outdated` | Show packages with newer versions available |
| `npm list` | List installed packages |
| `npm list --depth=0` | List only top-level packages |

### Information

| Command | Description |
|---------|-------------|
| `npm info <pkg>` | View package metadata |
| `npm search <keyword>` | Search the registry |
| `npm docs <pkg>` | Open package docs in browser |
| `npm audit` | Check for security vulnerabilities |
| `npm audit fix` | Auto-fix vulnerabilities |

### Project

| Command | Description |
|---------|-------------|
| `npm init` | Create `package.json` |
| `npm init -y` | Create with defaults |
| `npm start` | Run the "start" script |
| `npm test` | Run the "test" script |
| `npm run <script>` | Run a custom script |
| `npm cache clean --force` | Clear the npm cache |

---

## 8. `.gitignore` for Node.js Projects

The `.gitignore` file tells Git which files and directories to exclude from version control.

### Creating a `.gitignore`

Create a file named `.gitignore` in your project root:

```bash
# Dependencies — regenerated with npm install
node_modules/

# Environment variables — contains secrets
.env
.env.local
.env.production

# Logs
logs/
*.log
npm-debug.log*

# Build output
dist/
build/

# OS-generated files
.DS_Store
Thumbs.db

# IDE files
.vscode/
.idea/
*.sublime-project
*.sublime-workspace
```

### Key Rules

| Pattern | What It Ignores |
|---------|----------------|
| `node_modules/` | The entire dependencies folder |
| `.env` | Environment variables file |
| `*.log` | All log files |
| `dist/` | Build output directory |
| `!important.log` | Exception — do NOT ignore this file |
| `subdir/*.tmp` | `.tmp` files only in `subdir/` |

### Why These Files Are Ignored

| File/Folder | Why Ignore |
|-------------|------------|
| `node_modules/` | Can be rebuilt with `npm install` — often hundreds of MB |
| `.env` | Contains secrets (API keys, passwords) |
| `dist/` / `build/` | Generated from source code — can be rebuilt |
| `*.log` | Runtime artifacts, not source code |
| `.DS_Store` | macOS system file, not relevant to the project |

### Checking If a File Is Ignored

```bash
git check-ignore -v <file_name>
```

### Global `.gitignore`

For files that should be ignored across **all** your Git repositories:

```bash
git config --global core.excludesfile ~/.gitignore_global
```

Then add OS-specific patterns to `~/.gitignore_global`.

---

## 9. `npx` — Execute Packages Without Installing

`npx` runs a package without permanently installing it:

```bash
# Run a package directly
npx create-react-app my-app
npx eslint .
npx ts-node script.ts

# Run a specific version
npx express-generator@4
```

---

## 10. Summary

| Concept | Detail |
|---------|--------|
| NPM | Node.js package manager (CLI + registry) |
| `package.json` | Project manifest — dependencies, scripts, metadata |
| `package-lock.json` | Exact dependency versions — always commit this |
| `node_modules/` | Installed packages — always in `.gitignore` |
| `dependencies` | Packages needed at runtime |
| `devDependencies` | Packages needed only during development |
| SemVer | `MAJOR.MINOR.PATCH` — `^` allows minor updates |
| `npm scripts` | Custom commands in `package.json` |
| `.gitignore` | Files to exclude from Git |

### Key Points

1. Always run `npm init -y` to start a new project with a `package.json`
2. Use `--save-dev` / `-D` for packages only needed during development
3. **Never commit** `node_modules/` — add it to `.gitignore`
4. **Always commit** `package-lock.json` — ensures consistent installs
5. Use `npm audit` regularly to check for security vulnerabilities
6. The caret `^` in version ranges is the safest default — allows patches and minor updates
7. Add `.env` to `.gitignore` to protect sensitive information
